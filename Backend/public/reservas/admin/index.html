<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recibir reserva</title>
    <link rel="stylesheet" href="./index.css">
</head>

<body>
    <section>
        <h1>Respuesta del servidor</h1>
        <div id="response"></div>
    </section>

    <div id="reservations"></div>
</body>

<script src="/socket.io/socket.io.js"></script>

<script>
    const socket = io("http://localhost:3000")
    const root = document.getElementById("reservations")

    const setResponse = (message) => {
        const root = document.getElementById("response")
        root.innerHTML = message

        setTimeout(() => {
            root.innerHTML = ""
        }, 3000)
    }

    const renderReservations = (data) => {
        root.innerHTML = ""
        const { reservations } = data

        reservations.map(({ _id, username, patente, parking }) => {
            root.innerHTML += `
                <div class="card">
                    <div class="card-2">
                        <p>${username}</p>
                        <p>${patente}</p>
                        <p>${parking}</p>
                    </div>
                </div>
            `
        })
    }

    const addNewReservation = (data) => {

        const { reservation } = data
        const template = `
            <div class="card">
                <div class="card-2">
                    <p>${reservation.username}</p>
                    <p>${reservation.patente}</p>
                    <p>${reservation.parking}</p>
                    <p>${reservation.status}</p>
                </div>
            </div>
        `
        root.insertAdjacentHTML("beforeend", template)
    }

    socket.on("connect", () => {
        socket.emit("join-admin")
    })

    socket.on("all-reservations", (data) => {
        renderReservations(data)
    })

    socket.on("new-reservation", (data) => {
        addNewReservation(data)
    })

    socket.on("parking-exit-notification", async ({ message }) => {
        await setResponse(message)
    })

</script>

</html>